{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "curl -s -X POST http://localhost:$CCO_DAEMON_PORT/api/knowledge/session-start -H 'Content-Type: application/json' -d '{\"session_id\":\"'\"$CLAUDE_SESSION_ID\"'\",\"project_id\":\"'\"$CLAUDE_PROJECT_DIR\"'\"}'",
            "timeout": 5
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'input=$(cat); cmd=$(echo \"$input\" | jq -r \".tool_input.command // \\\"\\\"\" 2>/dev/null); mode=$(echo \"$input\" | jq -r \".permission_mode // \\\"default\\\"\" 2>/dev/null); result=$(curl -sf -X POST http://127.0.0.1:${CCO_DAEMON_PORT}/api/classify -H \"Content-Type: application/json\" -d \"{\\\"command\\\":\\\"$(echo \"$cmd\" | sed \"s/\\\"/\\\\\\\\\\\"/g\")\\\"}\"); classification=$(echo \"$result\" | jq -r \".classification // \\\"unknown\\\"\"); if [ \"$mode\" = \"bypassPermissions\" ]; then echo \"{\\\"hookSpecificOutput\\\":{\\\"hookEventName\\\":\\\"PreToolUse\\\",\\\"permissionDecision\\\":\\\"allow\\\",\\\"permissionDecisionReason\\\":\\\"CRUD: $classification (bypass mode)\\\"}}\"; elif [ \"$classification\" = \"Read\" ]; then echo \"{\\\"hookSpecificOutput\\\":{\\\"hookEventName\\\":\\\"PreToolUse\\\",\\\"permissionDecision\\\":\\\"allow\\\",\\\"permissionDecisionReason\\\":\\\"CRUD: READ operation\\\"}}\"; else echo \"{\\\"hookSpecificOutput\\\":{\\\"hookEventName\\\":\\\"PreToolUse\\\",\\\"permissionDecision\\\":\\\"ask\\\",\\\"permissionDecisionReason\\\":\\\"CRUD: $classification operation\\\"}}\"; fi'",
            "timeout": 3,
            "blocking": true
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "matcher": "manual",
        "hooks": [
          {
            "type": "command",
            "command": "curl -s -X POST http://localhost:$CCO_DAEMON_PORT/api/knowledge/pre-compaction -H 'Content-Type: application/json' -d '{\"session_id\":\"'\"$CLAUDE_SESSION_ID\"'\",\"project_id\":\"'\"$CLAUDE_PROJECT_DIR\"'\"}'",
            "timeout": 10
          }
        ]
      },
      {
        "matcher": "auto",
        "hooks": [
          {
            "type": "command",
            "command": "curl -s -X POST http://localhost:$CCO_DAEMON_PORT/api/knowledge/pre-compaction -H 'Content-Type: application/json' -d '{\"session_id\":\"'\"$CLAUDE_SESSION_ID\"'\",\"project_id\":\"'\"$CLAUDE_PROJECT_DIR\"'\"}'",
            "timeout": 10
          }
        ]
      }
    ]
  }
}
